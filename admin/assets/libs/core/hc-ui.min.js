/*! acp-core-js
Author:Leman Kwok <leman@lmswork.com>
Description:
Created:09-03-2017 12:56:34 */
!function(){var a={},b={};a.config={set:function(a,c){if("object"!=typeof arguments[0])b[a]=c;else{var d=arguments[0];for(var e in d)b[e]=d[e]}},get:function(a,c){return c||(c=null),a?"undefined"==typeof b[a]?c:b[a]:b}},window.hc=a}(),function(a){var b={code:null,text:{},setText:function(a,c){if("object"!=typeof a)b.text[a]=c;else for(var d in a)b.setText(d,a[d])},getText:function(a,c){var d=a,e=b.text,f=b.code;if("function"==typeof e?d=e(a):null!=f&&"undefined"!=typeof e[f][a]?d=e[f][a]:"undefined"!=typeof e[a]&&(d=e[a]),c)for(var a in c)d=d.replace("{"+a+"}",c[a]);return d}};a.loc=b}(hc),function(a){var b={};b.url=function(a,b){var c=b;return b&&"/"!=b.substr(b.length-1,1)&&a&&"/"!=a.substr(0,1)&&(c+="/"),c+a},b.site_url=function(c){return b.url(c,a.config.get("site_url",""))},b.asset_url=function(c){return b.url(c,a.config.get("asset_url",""))},a.net=b}(hc),function(a,b){var c=function(a){var c=b(a);b(d.modules).each(function(a,b){b(c)})},d={modules:[],initUIElement:c};a.ui=d}(hc,jQuery),function(a){a.showMessage=function(a,b,c,d){var e={text:"-",layout:"topCenter",type:b};return"object"==typeof a?e=a:e.text=a,e.type||(e.type="default"),d&&(e.layout=d),c&&(e.timeout=c),noty(e)}}(hc.ui),function(a,b){var c={show:!0,removeWhenHidden:!0,template:'<div class="modal"><div class="modal-dialog"><div class="modal-content"></div></div></div>',buttonTemplate:'<button type="button" class="btn" />',fade:!0,header:'<div class="modal-header" />',footer:'<div class="modal-footer" />',body:'<div class="modal-body" />',title:null,message:null,buttons:null},d=function(a){function c(){m=i.$elm.find(".btn,.form-control,select"),m.addClass("disabled"),k.append(n)}function d(){m.removeClass("disabled"),n.remove()}function e(){if(null==i.$elm){var c,d;c="function"==typeof a.template?a.template.apply(i,null):a.template;var e=b(c);if(i.$elm=e,c="function"==typeof a.header?a.header.apply(i,null):a.header,j=d=b(c),e.find(".modal-content").append(d),c="function"==typeof a.body?a.body.apply(i,null):a.body,k=d=b(c),e.find(".modal-content").append(d),c="function"==typeof a.footer?a.footer.apply(i,null):a.footer,l=d=b(c),e.find(".modal-content").append(d),null!=a.title&&j.append("function"==typeof a.title?a.title.apply(i,null):a.title),null!=a.message&&k.append("function"==typeof a.message?a.message.apply(i,null):a.message),null!=a.buttons)for(var f in a.buttons){var g,m=a.buttons[f];g=b(m.template?"function"==typeof m.template?m.template.apply(i,[m]):m.template:"function"==typeof a.buttonTemplate?a.buttonTemplate.apply(i,[m]):a.buttonTemplate),m.type&&("function"==typeof m.type?g.attr("type",m.type.apply(i,[m])):g.attr("type",m.type)),g.append(m.label?"function"==typeof m.label?m.label.apply(i,[m]):m.label:f),m["class"]&&g.addClass("function"==typeof m["class"]?m["class"].apply(i,[m]):m["class"]),m.events&&b(m.events).each(function(a,b){g.on(b.type,function(){b.callback.apply(i,arguments)})}),g.appendTo(l)}e.appendTo("body").modal({show:!1}),e.on("show.bs.modal",function(){"function"==typeof a.onShow&&a.onShow.apply(i,null)}),e.on("shown.bs.modal",function(){"function"==typeof a.onShown&&a.onShown.apply(i,null)}),e.on("hide.bs.modal",function(){"function"==typeof a.onHide&&a.onHide.apply(i,null)}),e.on("hidden.bs.modal",function(){"function"==typeof a.onHidden&&a.onHidden.apply(i,null),a.removeWhenHidden&&h()}),a.fade&&e.addClass("fade")}}function f(){null==i.$elm&&e(),null!=i.$elm&&i.$elm.modal("show")}function g(){null!=i.$elm&&i.$elm.modal("hide")}function h(){i.$elm&&i.$elm.remove(),i.$elm=null}var i=this;this.$elm=null,this.options=a;var j,k,l,m=null,n=b('<div class="modal-overlay" style="position:absolute; left:0; top:0; width:100%; height:100%; z-index:1000; background:white; opacity:0.1;" />');this.show=f,this.hide=g,this.install=e,this.destroy=h,this.lock=c,this.unlock=d,"function"==typeof a.onInit&&a.onInit.apply(i,null),a.show&&f()};d.defaults=c,a.Dialog=d,a.createDialog=function(a){return new d(b.extend({},c,a))}}(hc.ui,jQuery),function(exports,$){if(!$)return void console.error("ElementParser require jQuery");var _registeredDirectives={},_directiveKeys=[],defaultDirectives={text:function(a,b,c,d){"undefined"!=typeof moment&&"ago"==a.attr(""+d+"date-format")&&(c=moment(c).fromNow()),a.text(c)},href:function(a,b,c){a.prop("href",c)},target:function(a,b,c){a.prop("target",c)},placeholder:function(a,b,c){a.prop("placeholder",c)},data:function(a,b,c,d,e,f,g){if(c=defaultContentParser(g,"(function(){return "+b+"})()"),"object"==typeof c)for(var e in c)a.data(e,c[e])},attr:function(a,b,c,d,e,f,g){if(c=defaultContentParser(g,"(function(){return "+b+"})()"),"object"==typeof c)for(var e in c)a.attr(e,c[e])},id:function(a,b,c){a.prop("id",c)},name:function(a,b,c){a.prop("name",c)},"class":function(a,b,c){a.attr("class",c)},src:function(a,b,c){a.prop("src",c)},value:function(a,b,c){a.val(c)},title:function(a,b,c){a.prop("title",c)},html:function(a,b,c){a.html(c)},alt:function(a,b,c){a.prop("alt",c)},width:function(a,b,c){a.width(c)},height:function(a,b,c){a.height(c)},"background-image":function(a,b,c){a.css("background-image",c?"url("+c+")":"")},"if":function(a,b,c){c||a.remove()},"not-if":function(a,b,c){c&&a.remove()},loop:function(a,b,c,d,e,f){if(-1!=b.indexOf("..")){var g=b.split(".."),h=f(g[1]),i=a.parent();a.remove(),a.attr(d+e,null),$.isArray(h)&&$.each(h,function(b,c){var e={};e[g[0]]=c;var f=a.clone();i.append(f),hc.ui.ElementParser(f,e,d)})}}};defaultDirectives.data.isInternalParser=!0,defaultDirectives.attr.isInternalParser=!0,defaultDirectives.loop.isInternalParser=!0;var addDirective=function(a,b,c){return c||(c=_directiveKeys.length),"function"!=typeof b?(console.error("ElementParser.addDirective must pass function at 2th parameter"),!1):(_registeredDirectives[a]=b,c>=_directiveKeys.length?_directiveKeys.push(a):_directiveKeys.splice(c,0,a),!0)},getDirectiveAt=function(a){return 0>a||a>=_directiveKeys.length?null:_directiveKeys[a]},getDirective=function(a){return"undefined"!=typeof _registeredDirectives[a]?_registeredDirectives[a]:void 0},replaceDirective=function(a,b){"undefined"!=typeof _registeredDirectives[a]&&(_registeredDirectives[a]=b)},removeDirective=function(a){for(var b=[],c=0;c<_directiveKeys.length;c++)_directiveKeys[c]!=a&&b.push(_directiveKeys[c]);"undefined"!=typeof _registeredDirectives[a]&&(_registeredDirectives[a]=null,delete _registeredDirectives[a]),_directiveKeys=b},defaultContentParser=function(row,field){if("undefined"!=typeof field){if("undefined"!=typeof row[field])return row[field];try{with(row)return eval(field)}catch(err){}return""}};for(var key in defaultDirectives)addDirective(key,defaultDirectives[key]);var ElementParser=function(a,b,c){c||(c="rc-");var d=arguments[1];"function"!=typeof d&&(d=function(a){return ElementParser.contentParser(b,a)}),"function"!=typeof d&&(d=function(a){return defaultContentParser(b,a)}),$.each(_directiveKeys,function(e,f){var g=_registeredDirectives[f],h="function"==typeof g.parser?g.parser:d,i="undefined"!=typeof g.isInternalParser&&g.isInternalParser?g.isInternalParser:!1,j=c+f,k=a.find("["+j+"]");k.each(function(){var d=$(this),e=d.attr(j),k=i?null:h(e);g.call(a,d,e,k,c,f,h,b)})})};ElementParser.defaultDirectives=defaultDirectives,ElementParser.contentParser=defaultContentParser,ElementParser.addDirective=addDirective,ElementParser.getDirectiveAt=getDirectiveAt,ElementParser.getDirective=getDirective,ElementParser.removeDirective=removeDirective,ElementParser.replaceDirective=replaceDirective,exports.ElementParser=ElementParser}(hc.ui,jQuery),function(a){a.showLoaderAnimation=function(){$('<div class="global-loader"><div class="global-loader-wrap"><div class="loader"></div></div></div>').appendTo("body")},a.hideLoaderAnimation=function(){$(".global-loader").remove()}}(hc.ui),function(a,b){if(top.hc&&top.hc.ui&&top.hc.ui.openModal)return void(a.openModal=top.hc.ui.openModal);if(parent.hc&&parent.hc.ui&&parent.hc.ui.openModal)return void(a.openModal=parent.hc.ui.openModal);var c=function(a,d){if("undefined"==typeof a)return!1;d||(d={}),d=b.extend({},d,c.defaults);var e="ins_"+(new Date).getTime()+"_"+(1e3*Math.random()<<0),f=-1!=a.indexOf("?")?a.substr(a.indexOf("?")):"";a+=""==f?"?":"&",a+="_modalIns="+e,"undefined"!=typeof d.urlAppendStr&&""!=d.urlAppendStr&&(a+="&"+d.urlAppendStr);var g=b('<div class="modal"></div>'),h=g,i=g;c.instances[e]=g;var j=null;"function"==typeof d.header?j=d.header():"string"==typeof d.header&&d.header.length>0?j=b(d.header):"string"==typeof d.title&&d.title.length>0&&(j=b('<div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h3>'+d.title+"</h3></div>"));var k=null;"function"==typeof d.footer?k=d.footer():"string"==typeof d.footer&&d.header.length>0&&(k=b(d.footer)),h=b('<div class="modal-dialog" />'),"large"==d.size&&h.addClass("modal-lg"),"fluid"==d.size&&h.addClass("modal-fluid"),h.appendTo(g),i=h,i=b('<div class="modal-content" />'),i.appendTo(h),j&&i.append(j);var l=b('<iframe class="modal-iframe" />').width(d.width).height(d.height).prop("src",a);return l.appendTo(i),k&&i.append(k),g.on("hidden.bs.modal",function(a){"undefined"!=typeof d.srcElement&&d.srcElement&&b(d.srcElement).trigger("sb.hidden",a),"undefined"!=typeof d.onHidden&&d.onHidden&&d.onHidden.apply(g,[]),c.instances[e]=null,g.remove(),g=null,d=null}).on("shown.bs.modal",function(a){"undefined"!=typeof d.srcElement&&d.srcElement&&b(d.srcElement).trigger("sb.shown",a),"undefined"!=typeof d.onShown&&d.onShown&&d.onShown.apply(g,[])}),g.modal(d)};c.instances={},c.defaults={width:"100%",height:500,urlAppendStr:"dialog=yes",size:"fluid",header:"",footer:"",title:"",removeWhenClose:!0},a.openModal=c}(hc.ui,top.jQuery||parent.jQuery||self.jQuery),function(a){var b=function(b,c){var d=this,e=a(b),f=e.find("form.ifrm");d.options=c,d.$scope=e,d.$form=f,e.length<1&&console.error("No element found by passed scope:",b),e.addClass("record-editor"),c.apiPathPrefix&&(d.apiPathPrefix=c.apiPathPrefix),c.id&&(d.id=c.id),c.richEditorConfig&&(d.richEditorConfig=c.richEditorConfig),c.text&&(d.text=c.text),a(window).on("keyup",function(a){a.altKey||a.shiftKey||!a.ctrlKey&&!a.commandKey||"s"!=String.fromCharCode(a.keyCode).toLowerCase()||(f.submit(),a.preventDefault())}),e.on("click","[re-action]",function(b){b.preventDefault();var e=a(this).attr("re-action");return"close"==e?void window.close():"save"==e||"submit"==e?void d.submit():"publish"==e?void d.publish():void("function"==typeof c.onExecuteAction&&c.onExecuteAction(e,this))}),"function"==typeof d.initialize&&d.initialize(),"function"==typeof c.initialize&&c.initialize(d),this.handleArgument=function(a){if(arguments.length<1)return d;for(var b=[],c=1;c<arguments.length;c++)b.push(arguments[c]);return a&&"function"==typeof d[a]?d[a].apply(d,b):void 0}},c={apiPathPrefix:"",id:null,bridge:null,richEditorConfig:null,initialize:function(){var b=this,c=b.$scope,d=b.$form;if(b.updateStatus(),hc.ui.initUIElement(c),"undefined"!=typeof window.tinyMCE){var e=b.richEditorConfig||{};c.find(".rich-editor").each(function(){tinymce.init(e)})}var f=Fragment.parseQuery(location.search);bridge=new SelectorBridge,this.bridge=bridge,bridge.multiSelect="yes"==f.multiple,bridge.getIds=function(){return b.id?[b.id]:[]},bridge.onSelectTooMuch=function(){hc.ui.showMessage(hc.loc.getText("error_select_too_much"),"error")},bridge.onUpdate=function(){},bridge.onReload=function(){bridge.ids=bridge.getIds()},f&&f.callback&&bridge.connect(f.callback);var g=!1,h={onSubmit:function(){if(c.find(".form-group").removeClass("has-error").removeClass("has-warning"),b.options.iframe&&".html"!=this.action.substr(this.action.length-5,5)&&(this.action+=".html"),g)return hc.ui.showMessage(hc.loc.getText("error_processing"),"error"),!1;var e=!0,f=[];return c.find("[re-required]").each(function(){var b=a(this).val();(!b||b.length<1)&&(e=!1,f.push(this))}),c.find("[re-error]").each(function(){e=!1;var b=a(this).attr("re-error");b&&b.length>0&&hc.ui.showMessage(b,"error")}),e?g=!0:f.length>0&&(a(f).each(function(){a(this).parents(".form-group").addClass("has-error")}),hc.ui.showMessage(hc.loc.getText("error_required_empty"),"error"),d.trigger("error",[])),e&&d.trigger("submitting",[]),e},onResponse:function(a){g=!1;var e=this;if(a.id&&(hc.ui.showMessage(hc.loc.getText("record_saved"),"success",5e3),!b.id)){b.id=a.id;var f=b.apiPathPrefix+"/"+b.id+"/edit";c.find("input[name=id]",e).val(b.id),b.updateStatus(),History.pushState(null,null,f)}return a.error&&a.error.message&&hc.ui.showMessage(a.error.message,"error"),d.trigger("response",[a]),hc.auth.isResultRestrict(a)?hc.auth.handleLogin(function(){b.submit()}):void 0},onError:function(){g=!1,hc.ui.showMessage(hc.loc.getText("error_cannot_save"),"error"),d.trigger("error",[])},onTimeout:function(){g=!1,hc.ui.showMessage(hc.loc.getText("error_timeout"),"error"),d.trigger("error",[])}};this.options.iframe?d.ifrm(h):d.on("submit",function(c){c.preventDefault();var e=h.onSubmit.apply(d.get(0),[]);e&&a.ajax({url:b.getURL(),data:b.getData(),type:"post",dataType:"json",success:function(a){h.onResponse.apply(d.get(0),[a])},error:function(){h.onError.apply(d.get(0),[])}})})},getURL:function(){var a=this,b=a.$form,c=b.prop("action");return this.options.iframe||(c+=".json"),a.options.getURL&&(c=a.options.getURL.apply(a,[a.$form])),c},getData:function(){var a=this,b=a.$form,c=b.serialize();return a.options.getData&&(c=a.options.getData.apply(a,[a.$form])),b.serialize()},submit:function(){var a=this;"undefined"!=typeof window.tinyMCE&&tinyMCE.triggerSave(),a.$form.submit()},publish:function(){var b=this;b.id&&a.post(b.apiPathPrefix+"/batch/publish","ids="+b.id,function(a){a.data&&hc.ui.showMessage(hc.loc.getText("record_published"),"success",5e3)},"json")},updateStatus:function(){var a=this,b=a.$scope;a.id?(b.find(".record-editor [re-visible=edit]").removeClass("hidden"),b.find(".record-editor [re-hidden=edit]").addClass("hidden"),b.find(".visible-edit").removeClass("hidden"),b.find(".hidden-edit").addClass("hidden")):(b.find(".record-editor [re-visible=edit]").addClass("hidden"),b.find(".record-editor [re-hidden=edit]").removeClass("hidden"),b.find(".visible-edit").addClass("hidden"),b.find(".hidden-edit").removeClass("hidden"))}};b.prototype=c,b.defaults={text:null,iframe:!1,getURL:null,getData:null},"undefined"==typeof window.hc&&(window.hc={}),"undefined"==typeof window.hc.ui&&(window.hc.ui={}),hc.ui.RecordEditor=b,a.fn.recordEditor=function(c){var d=arguments,e="each",f="record-editor";if(d.length>0&&"object"!=typeof d[0]||0==d.length){var g=a(this).eq(0);if(g.length){var h=g.data(f);if(h)return h.handleArgument.apply(this,d)}}return a(this)[e](function(){var e=this,g=a(e),h=g.data(f);return h?h.handleArgument.apply(this,d):(h=new b(g,a.extend({},c,b.defaults)),void g.data(f,h))})}}(jQuery),function(hc,$){var RecordRow=function(elm,rrId,dataRow,options){function getData(field){if("undefined"==typeof field)return dataRow;var row=dataRow;if("undefined"!=typeof dataRow[field])return dataRow[field];if(""!=field){try{return eval(field)}catch(err){}return null}return null}function setData(a){return dataRow=a,update(),self}function update(){return"function"==typeof options.beforeUpdate&&options.beforeUpdate.apply(self,[$rowElm,dataRow]),hc.ui.ElementParser($rowElm,getData),"function"==typeof options.afterUpdate&&options.afterUpdate.apply(self,[$rowElm,dataRow]),self}var $elm=$(elm),self=this;this.rrId=rrId,this.elm=elm,this.$elm=$elm,this.options=options;var $rowElm=$elm,_checked=!1;$rowElm.prop("id","rr-"+rrId).data("rr-id",rrId).on("click","td,th",function(a){if(!$rowElm.hasClass("disabled")){var b=$(a.target);b.is(".btn,.btn-link,a,.label,.dropdown")||b.parents(".btn,a,.label,.dropdown").length>0||(a.preventDefault(),self.toggleChecked())}}),$rowElm.find("input[type=checkbox]").val(rrId),dataRow.is_image&&$rowElm.find(".thumbnail").css("background-image","url("+dataRow.image.thumbnail+")"),"function"==typeof options.parseRow&&options.parseRow.apply(self,[$rowElm,dataRow]);var $btnSelect=$rowElm.find(".btn-select"),$icon=$rowElm.find(".btn-select i");this.getDisabled=function(){return $rowElm.hasClass("disabled")},this.setDisabled=function(a){return a?$rowElm.addClass("disabled"):$rowElm.removeClass("disabled"),"function"==typeof options.onDisabledStateChange&&options.onDisabledStateChange.apply(this,null),self},this.getChecked=function(){return _checked},this.setChecked=function(a){return _checked=a,$icon.removeClass().addClass("fa"),a?($rowElm.addClass("active"),$icon.addClass($icon.data("active")),$btnSelect.addClass("btn-success")):($rowElm.removeClass("active"),$icon.addClass($icon.data("deactive")),$btnSelect.removeClass("btn-success")),"function"==typeof options.onCheckedStateChange&&options.onCheckedStateChange.apply(self,null),self},this.toggleChecked=function(){return self.setChecked(!_checked),self},this.getData=getData,this.update=update,this.setData=setData,update(),$rowElm.data("record-row",self)},_rr_counter=0;RecordRow.createID=function(){var a="RR"+_rr_counter++;return a};var RecordList=function(elm,options){function _error(){"function"==typeof options.onError?options.onError.apply(self,arguments):alert(arguments.length>0?"Error: "+arguments[0]:"Unknown error.")}function updateSelectAllButton(){$elm.find(_selector_select_all_button).each(function(){var a=$(this),b=a.find("> i");_selected_all_current?(a.addClass("active"),b.removeClass(b.data("deactive")).addClass(b.data("active"))):(a.removeClass("active"),b.removeClass(b.data("active")).addClass(b.data("deactive")))})}function selectCurrent(){_selected_all_current=!0;for(var a=0;a<_rrIds.length;a++){var b=_rrIds[a],c=getRowElmByRRID(b);c&&c.setChecked(!0)}updateSelectAllButton()}function deselectCurrent(){_selected_all_current=!1;for(var a=0;a<_rrIds.length;a++){var b=_rrIds[a],c=getRowElmByRRID(b);c&&c.setChecked(!1)}updateSelectAllButton()}function getRowElmByDataID(a){var b=_rr_data_map[a];return"undefined"!=typeof _rr_elm_map[b]?_rr_elm_map[b]:null}function updateRowElmByDataID(a,b){if("undefined"!=typeof _rr_data_map[a]){var c=_rr_data_map[a],d=getRowElmByRRID(c);d&&(b?(b._rrId=c,_rr_data_map[a]=b,d.setData(b)):d.update())}}function getRowElmByRRID(a){return"undefined"!=typeof _rr_elm_map[a]?_rr_elm_map[a]:null}function getRowByDataID(a){if("undefined"!=typeof _rr_data_map[a]){var b=_rr_data_map[a];return _rr_data[b]}return null}function getRows(){return _rr_data}function doBatch(a,b,c){c||(c=_rr_selected_ids);for(var d=[],e=0;e<c.length;e++)d.push(c[e]);return"function"==typeof options.onBatch?options.onBatch.apply(self,[a,d,b]):!1}function doRowAction(a,b,c){var d=null;return"undefined"!=typeof _rr_data[c]&&(d=_rr_data[c].id),"function"==typeof options.onRowAction?options.onRowAction.apply(self,[a,b,d]):!1}function updateAfterSelectedItemChange(){1>_selected_counter?(null!=options.selectorSend&&$(options.selectorSend).addClass("disabled").prop("disabled",!0),""!=$elm.attr("rl-select-button")&&"undefined"!=typeof $elm.attr("rl-select-button")&&$($elm.attr("rl-select-button")).addClass("disabled").prop("disabled",!0),$(".btn-rr-select").addClass("seletcted").prop("disabled",!0)):(null!=options.selectorSend&&$(options.selectorSend).removeClass("disabled").prop("disabled",!1),""!=$elm.attr("rl-select-button")&&"undefined"!=typeof $elm.attr("rl-select-button")&&$($elm.attr("rl-select-button")).removeClass("disabled").prop("disabled",!1),$(".btn-rr-select").removeClass("seletcted").prop("disabled",!1))}function addSelectedDataId(a){if(a){var b=$.inArray(a,_rr_selected_ids);0>b&&(_rr_selected_ids.push(a),_selected_counter++),updateAfterSelectedItemChange()}}function removeSelectedDataId(a){if(a){var b=$.inArray(a,_rr_selected_ids);b>=0&&(_selected_counter--,_rr_selected_ids.splice(b,1)),updateAfterSelectedItemChange()}}function getSelectedIds(){return _rr_selected_ids}function createElement(a){if($template.length<1)throw new Error("$template is empty.");var b=null;a.id&&_rr_mapping[a.id]||(b=RecordRow.createID()),a.id?_rr_mapping[a.id]?b=_rr_mapping[a.id]:_rr_mapping[a.id]=b:_rr_new_ids[b]=!0,a._rrId=b,a.id&&(_rr_data_map[a.id]=b),_rr_data[b]=a,_rr_parameters[b]="undefined"!=typeof a.parameters?a.parameters:{},_rrIds.push(b);var c=$template.eq(0).clone();c.removeClass("template").addClass("rr"),$elm.find(options.containerSelector).append(c);var d=new RecordRow(c,b,a,{onCheckedStateChange:function(){var a=this.getData();this.getChecked()?addSelectedDataId(a.id):(removeSelectedDataId(a.id),_selected_all_current&&(_selected_all_current=!1,updateSelectAllButton()))},beforeUpdate:options.onRowBeforeUpdate,afterUpdate:options.onRowAfterUpdate});return $.inArray(a.id,_rr_selected_ids)>=0&&d.setChecked(!0),"function"==typeof options.onRowCreate&&options.onRowCreate.apply(self,[d,a]),_rr_elm_map[b]=d,d}function select(a){return $(a).each(function(a,b){addSelectedDataId(b);var c=getRowElmByDataID(b);c&&c.setChecked(!0)}),self}function deselect(a){return $(a).each(function(a,b){removeSelectedDataId(b);var c=getRowElmByDataID(b);c&&c.setChecked(!1)}),self}function updatePaging(){0>=offset?$elm.find(".pager .previous, .pagination .previous").addClass("disabled"):$elm.find(".pager .previous, .pagination .previous").removeClass("disabled");var a=offset+limit;a>=total?$elm.find(".pager .next, .pagination .next").addClass("disabled"):$elm.find(".pager .next, .pagination .next").removeClass("disabled"),$elm.find(".pagination .paging-total").text(total),$elm.find(".pagination .paging-offset-start").text(Math.min(total,offset+1)),$elm.find(".pagination .paging-offset-end").text(Math.min(total,a)),"function"==typeof options.onUpdatePaging&&options.onUpdatePaging.apply(self,[offset,total])}function updateToolbar(){bridge&&bridge.onReload();var a=1>_selected_counter;$elm.find(".btn-rr-select,.btn-selected-action").prop("disabled",a).button(a?"disable":"enable"),"function"==typeof options.onUpdateToolbar&&options.onUpdateToolbar.apply(self,[_selected_counter])}function handleAfterReload(rst){$elm.find("[rl-text]").each(function(){var $elm=$(this),q=$(this).attr("rl-text"),val=null;if(q&&q.length>0)try{val=eval(q)}catch(exp){}val&&$elm.text(val)}).find("[rl-html]").each(function(){var $elm=$(this),q=$(this).attr("rl-html"),val=null;if(q&&q.length>0)try{val=eval(q)}catch(exp){}val&&$elm.html(val)}).find("[rl-value]").each(function(){var $elm=$(this),q=$(this).attr("rl-value"),val=null;if(q&&q.length>0)try{val=eval(q)}catch(exp){}val&&$elm.val(val)})}function parse(a){if(hc.auth.isResultRestrict(a))return hc.auth.handleLogin(reload);clearRows(),"function"==typeof options.afterSearch&&options.afterSearch.apply(self,[lastQueryURL,lastQueryData,a]),updateToolbar();var b=a;if("function"==typeof options.onParse&&(b=options.onParse.apply(self,[lastQueryURL,lastQueryData,a])),b&&(a=b),a.data){"undefined"!=typeof a.paging&&(offset=parseInt(a.paging.offset),limit=parseInt(a.paging.limit),total=parseInt(a.paging.total),updatePaging()),handleAfterReload(a),$empty.length&&$empty.remove();for(var c=0,d=0;d<a.data.length;d++){var e=createElement(a.data[d]);e.getChecked()&&c++}a.data.length<1&&$empty.length&&$elm.find(options.containerSelector).append($empty),c>=limit&&(_selected_all_current=!0,updateSelectAllButton())}else a.error&&a.error.message&&_error(a.error.message)}function clearRows(){$elm.find(".rr").remove(),_selected_all_current=!1,updateSelectAllButton(),_rrIds.length=0,_rr_data_map={},_rr_elm_map={}}function reload(){loader&&(loader.abort(),loader=null);var a=options.acceptingParams,b=options.queryParams,c={},d={};b||(b=a);for(var e=0;e<a.length;e++)"undefined"!=typeof queries[a[e]]&&(d[a[e]]=queries[a[e]]);for(var e=0;e<b.length;e++)"undefined"!=typeof queries[b[e]]&&(c[b[e]]=queries[b[e]]);(!c.offset||c.offset<0)&&(c.offset=0),c.offset=parseInt(c.offset),(!c.limit||c.limit<1)&&(c.limit=25),c.limit=parseInt(c.limit);var f=$elm.find(".btn:not(.disabled), .pagination li:not(.disabled) a, .pager li:not(.disabled) a");f.addClass("disabled"),lastQueryURL=options.searchURL,lastQueryData=d;var g="function"==typeof options.searchOption?options.searchOption.apply(self,[c]):{url:options.searchURL,data:c,dataType:"json"};g.error=function(){$elm.addClass("rl-loading"),$elm.removeClass("rl-error"),loader=null,f.removeClass("disabled"),"function"==typeof options.afterSearch&&options.afterSearch.apply(self,[lastQueryURL,lastQueryData,null]),$empty.length&&$elm.find(options.containerSelector).append($empty)},g.success=function(a){$elm.removeClass("rl-error"),$elm.removeClass("rl-loading"),loader=null,f.removeClass("disabled"),parse(a)},"function"==typeof options.beforeSearch&&options.beforeSearch.apply(self,[lastQueryURL,lastQueryData,g]),$elm.removeClass("rl-error"),$elm.addClass("rl-loading"),loader=$.ajax(g)}function send(){bridge&&bridge.send()&&window.close()}var self=this;self.options=options;var $elm=$(elm);self.$elm=$elm;var bridge=null,limit=options.limit,offset=options.offset,total=0,queries=options.queries?options.queries:{},_selector_select_all_button=".btn-toggle-select-all:not(.disabled),[rl-toggle-select-all]:not(.disabled)",_rrIds=[],_rr_new_ids={},_rr_mapping={},_rr_data={},_rr_data_map={},_rr_elm_map={},_rr_parameters={},_rr_selected_ids=[],_selected_counter=0,_selected_all_current=!1,_enable_multiple=!1,$template=$(options.containerSelector+" .template",$elm),$empty=$(options.containerSelector+" .empty",$elm);$template.remove(),$empty.length&&$empty.remove();var $lockedUI=null,lastQueryURL=null,lastQueryData=null,loader=null,initialType=null;if(null!=options.selectorSend&&$(options.selectorSend).on("click",function(){send()}),""!=$elm.attr("rl-select-button")&&"undefined"!=typeof $elm.attr("rl-select-button")&&$($elm.attr("rl-select-button")).on("click",function(){send()}),$("body").on("click",".btn-rr-select,[rr-select]",function(a){a.preventDefault(),send()}),$elm.on("click",".btn-reload,[rl-reload]:not(.disabled)",function(){reload()}).on("click",_selector_select_all_button,function(){_selected_all_current?deselectCurrent():selectCurrent()}).on("click",".btn-rr-select:not(.disabled),[rl-send]:not(.disabled)",function(){send()}).on("click",".btn-selected-action a:not(.disabled)",function(){var a=$(this).data(),b=a.action;doBatch(b,a)}).on("change",".searchbar .search-order input",function(){queries.direction=$(this).val(),"function"==typeof options.queryUpdate?options.queryUpdate.apply(self,[queries]):reload()}).on("submit",".searchbar",function(a){a.preventDefault();var b=$elm.find(".searchbar input[name=q]",this).val();queries.q=b&&b.length>0?b:null,queries.offset=0,"function"==typeof options.queryUpdate?options.queryUpdate.apply(self,[queries]):reload()}).on("click",".pager .previous:not(.disabled) a, .pagination .previous:not(.disabled) a",function(a){a.preventDefault(),offset-=limit,0>offset&&(offset=0),queries.offset=offset,"function"==typeof options.queryUpdate?options.queryUpdate.apply(self,[queries]):reload()}).on("click",".pager .next:not(.disabled) a, .pagination .next:not(.disabled) a",function(a){a.preventDefault(),total>offset+limit&&(offset+=limit,queries.offset=offset,"function"==typeof options.queryUpdate?options.queryUpdate.apply(self,[queries]):reload())}).on("click",options.containerSelector+" .rr .btn-select:not(.disabled)",function(a){{var b=$(this),c=b.parents(".rr"),d=c.data("record-row");c.data("rr-id")}d.toggleChecked(),updateToolbar(),a.preventDefault()}).on("click",options.containerSelector+" .rr *[rc-action]:not(.disabled)",function(a){var b=$(this),c=(b.data(),b.attr("rc-action")),d=b.parents(".rr"),e=(d.data("record-row"),d.data("rr-id"));doRowAction(c,this,e)&&a.preventDefault()}).on("change","[name=sort]",function(a){a.preventDefault();var b=$(this);queries.sort=b.val(),"function"==typeof options.queryUpdate?options.queryUpdate.apply(self,[queries]):reload()}),$elm.on("click",options.containerSelector+" .rr .rc-hide",function(){var a=($(this),$(this).parents(".rr"));a.remove()}),this.createElement=createElement,this.updatePaging=updatePaging,this.updateToolbar=updateToolbar,this.reload=reload,this.select=select,this.deselect=deselect,this.getRows=getRows,this.getRowByDataID=getRowByDataID,this.getRowElmByDataID=getRowElmByDataID,this.getRowElmByRRID=getRowElmByRRID,this.updateRowElmByDataID=updateRowElmByDataID,this.selectCurrent=selectCurrent,this.deselectCurrent=deselectCurrent,this.getSelectedIds=getSelectedIds,this.getQuery=function(){return queries},this.setQuery=function(a){queries=a},this.getBridge=function(){return bridge},this.handleArgument=function(a){if(arguments.length<1)return self;for(var b=[],c=1;c<arguments.length;c++)b.push(arguments[c]);return a&&"function"==typeof self[a]?self[a].apply(self,b):void 0},this.setTemplate=function(a){return $template=$(a),self},this.setEmpty=function(a){return $empty=$(a),self},this.addQueryField=function(a){return $.isArray(a)?($(a).each(function(a,b){self.addQueryField(b)}),self):(options.acceptingParams.push(a),options.queryParams.push(a),self)},bridge=new SelectorBridge,_enable_multiple=bridge.multiSelect=options.selectorMultiple||"yes"==options.selectorMultiple,bridge.getIds=function(){return _rr_selected_ids},bridge.onSelectTooMuch=function(){hc.ui.showMessage(hc.loc.getText("error_select_too_much"),"error")},bridge.onUpdate=function(){$elms=$elm.find(".rr"),$elms.each(function(a,b){var c=$.inArray(b.recordRow("getData").id,bridge.ids)>=0;b.recordRow("setChecked",c)})},bridge.onReload=function(){bridge.ids=bridge.getIds()},options.selectorValue){var _sv=$.isArray(options.selectorValue)?options.selectorValue:options.selectorValue.replace(/[\s\t\r\n]*/,"").split(",");$(_sv).each(function(a,b){addSelectedDataId(b)})}options.extraParams&&this.addQueryField(options.extraParams),options.selectorCallback&&bridge.connect(options.selectorCallback);var reloadFirst=!0;"function"==typeof options.onInit&&(reloadFirst=options.onInit.apply(self,null)),updateAfterSelectedItemChange(),reloadFirst&&reload()};$.recordList={defaults:{selectorCallback:null,selectorValue:null,selectorMultiple:null,selectorValue:null,selectorSend:null,dataRowId:"id",dataRowTitle:"title",containerSelector:".table tbody",onInit:null,onRowCreate:null,onRowAction:null,onRowBeforeUpdate:null,onRowAfterUpdate:null,onBatch:null,remote:!0,searchURL:"",searchOption:null,beforeSearch:null,afterSearch:null,queryUpdate:null,offset:0,limit:25,queries:null,acceptingParams:["offset","limit","sort","direction","q","status","type","_modalIns","dialog","callback"],queryParams:["offset","limit","sort","direction","q","status","type"]}},$.recordRow={defaults:{beforeUpdate:null,afterUpdate:null,onCheckedStateChange:null}},$.fn.recordList=function(a){var b=arguments,c="each",d="record-list";if(b.length>0&&"object"!=typeof b[0]||0==b.length){var e=$(this).eq(0);if(e.length){var f=e.data(d);if(f)return f.handleArgument.apply(this,b)}}return $(this)[c](function(){var c=this,e=$(c),f=e.data(d);return f?f.handleArgument.apply(this,b):(f=new RecordList(e,$.extend({},$.recordList.defaults,a)),void e.data(d,f))})},$.fn.recordRow=function(a){var b=arguments,c="each",d="record-row";if(b.length>0&&"object"!=typeof b[0]||0==b.length){var e=$(this).eq(0);if(e.length){var f=e.data(d);if(f)return f.handleArgument.apply(this,b)}}return $(this)[c](function(){var c=this,e=$(c),f=e.data(d);return f?f.handleArgument.apply(this,b):(f=new RecordRow(e,$.extend({},$.recordRow.defaults,a)),void e.data(d,f))})}}(hc,jQuery),function(a,b){var c=function(){this.visible=!1,this.initialize.apply(this,arguments)};c.prototype.el=null,c.prototype.options=null,c.prototype.visible=!1,c.prototype.initialize=function(a){this.el=a.el,this.options=a,this.target=a.target,this.scope=a.scope,this.bindElm(),this.update()},c.prototype.bindElm=function(){var a=this,c=a.options.scope?b(this.target,a.options.scope):b(this.target);a.$target=c,c.on("change",function(){a.update()})},c.prototype.update=function(){};var d=function(a){this.type="select",this.value=a.value,this.initialize.apply(this,arguments)};d.prototype=b.extend({},c.prototype),
d.prototype.update=function(){var a=this;this.visible=a.$target.find("option[value="+this.value+"]").is(":selected"),"function"==typeof this.options.onUpdate&&this.options.onUpdate.apply(this,[])};var e=function(a){this.type="checkbox",this.target=a.target,this.initialize.apply(this,arguments)};e.prototype=b.extend({},c.prototype),e.prototype.initialize=function(a){this.el=a.el,this.options=a,this.target=a.target,this.scope=a.scope,this.bindElm(),this.update()},c.prototype.bindElm=function(){var a=this,c=a.options.scope?b(this.target,a.options.scope):b(this.target);a.$target=c,c.on("change",function(){a.update()})},e.prototype.update=function(){var a=self.options.scope?b(this.target,self.options.scope):b(this.target);this.visible=a.is(":checked"),"function"==typeof this.options.onUpdate&&this.options.onUpdate.apply(this,[])},a.VGCore=c,a.VGCheckbox=e,a.VGSelect=d,a.modules.push(function(a){a.find("[vg-select],[vg-checked]").each(function(){var c=b(this),f=[],g=function(){var a=0;b(f).each(function(b,c){c.visible&&a++}),a>=f.length?c.show():c.hide()};null!=c.attr("vg-select")&&f.push(new d({scope:a,el:c,target:c.attr("vg-select"),value:c.attr("vg-select-value"),onUpdate:g})),null!=c.attr("vg-checked")&&f.push(new e({scope:a,el:c,target:c.attr("vg-checked"),onUpdate:g})),g()})})}(hc.ui,jQuery);